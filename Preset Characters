shrink=0.10 --- shrink factor, do not edit

local button_parameters = {}
button_parameters.click_function = 'currentSceneGet'
button_parameters.function_owner = self
button_parameters.label = 'Save Map'
button_parameters.position = {18, 0.5,  20}
button_parameters.rotation = {0, 0, 0}
button_parameters.width = 4000
button_parameters.height = 2000
button_parameters.font_size = 1000
self.createButton(button_parameters)

local button_parameters = {}
button_parameters.click_function = 'currentSceneSend'
button_parameters.function_owner = self
button_parameters.label = 'Load Map'
button_parameters.position = {-17, 0.5, 20}
button_parameters.rotation = {0, 0, 0}
button_parameters.width = 4000
button_parameters.height = 2000
button_parameters.font_size = 1000
self.createButton(button_parameters)

function currentSceneGet()
  tableguid='413e0c'
  activesceneobjects=getObjectFromGUID(tableguid).getObjects()
  for i,v in pairs(activesceneobjects) do
    if activesceneobjects[i].name~='Board' and activesceneobjects[i].guid~='1c1c26' and not activesceneobjects[i].getVar('shrink') then
      scaletbl=activesceneobjects[i].getScale()
      activesceneobjects[i].setScale({scaletbl['x']*self.getVar('shrink'),scaletbl['y']*self.getVar('shrink'),scaletbl['z']*self.getVar('shrink')})
    end
  end
  for i,v in pairs(activesceneobjects) do
    if activesceneobjects[i].name~='Board' and activesceneobjects[i].guid~='1c1c26' and not activesceneobjects[i].getVar('shrink') then
      pos=activesceneobjects[i].getPosition()
      activesceneobjects[i].setPosition({pos['x']*self.getVar('shrink'),pos['y']*self.getVar('shrink'),pos['z']*self.getVar('shrink')})
    end
  end
  for i,v in pairs(activesceneobjects) do
    if activesceneobjects[i].name~='Board' and activesceneobjects[i].guid~='1c1c26' and not activesceneobjects[i].getVar('shrink') then
      pos=activesceneobjects[i].getPosition()
      postarget=self.getPosition()
      activesceneobjects[i].setPosition({pos['x']+postarget['x'],pos['y']+postarget['y'],pos['z']+postarget['z']})
    end
  end
  self.lock()
  self['interactable'] = false
  getObjectFromGUID('MapName').TextTool.setValue(" ")
end

function currentSceneSend()
  posself=self.getPosition()
  allobjects=getAllObjects()
  for i,v in pairs(allobjects) do
    pos=allobjects[i].getPosition()
    if allobjects[i].name~='Board' and allobjects[i].guid~=self.guid and pos['x']>=(posself['x']-8) and pos['x']<=(posself['x']+8) and pos['z']>=(posself['z']-8) and pos['z']<=(posself['z']+8) then
      allobjects[i].setPosition({pos['x']-posself['x'],pos['y']-posself['y'],pos['z']-posself['z']})
      pos=allobjects[i].getPosition()
      allobjects[i].setPosition({pos['x']*(1/self.getVar('shrink')),pos['y']*(1/self.getVar('shrink')),pos['z']*(1/self.getVar('shrink'))})
      scaletbl=allobjects[i].getScale()
      allobjects[i].setScale({scaletbl['x']*(1/self.getVar('shrink')),scaletbl['y']*(1/self.getVar('shrink')),scaletbl['z']*(1/self.getVar('shrink'))})
    end
  end
  self['interactable'] = true
  if string.len(self.getName()) > 1 then getObjectFromGUID('MapName').TextTool.setValue(self.getName())
  else getObjectFromGUID('MapName').TextTool.setValue(' ') end
end
